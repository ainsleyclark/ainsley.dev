<!-- =====================
    Picture
		partial "media/picture.html" (dict "global" . "url" "/images/hello.jpg" "lazy" true "mobile" false "class" "class-name" "id" "id-name")
		- global:			The global context, this has to be parsed or an error will be thrown.
		- url:				The relative URL of the resource/image, this has to be parsed or an error will be thrown.
		- lazy:				If the image should be lazy loaded, defaults to false.
		- [css-key] bool:	Hide a particular viewport by outputting a 1px dot. See .Params for the css keys.
		https://bitbanged.com/posts/using-responsive-images-effortlessly-with-hugo/
    ===================== -->
{{ $showAvifWebp := ne hugo.Environment "development" -}}
{{ if .image }}
	<!-- Container Sizes -->
	{{ range $size := sort site.Params.css.container -}}
        {{ $item := index $ $size.name }}
		<!-- Show a 1px Dot if the current key is set to "hide" -->
        {{ if and (eq (isset $ $size.name) true) (eq (index $item) "hide") }}
			<source media="(max-width:{{ $size.size }}px)" sizes="1px"
					srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>
		{{ else }}
			{{ $src := "" }}
			<!-- Display Image, type is resource -->
			{{ if and (eq (isset $ $size.name) true) (in (printf "%T" $item) "resource") }}
				{{ $src = $item }}
			<!-- Resize if the image is greater than the image and the item is not set -->
			{{- else if (gt $.image.Width $size) }}
				{{- $src = $.image.Resize (printf "%dx" $size.size) -}}
			{{- end }}
			{{ if $src }}
				{{ if $showAvifWebp -}}
					{{- $noExtension := strings.TrimSuffix (path.Ext $src.RelPermalink) $src.RelPermalink -}}
					<!-- AVIF -->
					<source media="(max-width: {{ $size.size }}px)" {{ if $.lazy }} class="lazy lazy-hide"
							data-{{ end }}srcset="{{ $noExtension }}.avif" type="image/avif"/>
					<!-- WebP -->
					<source media="(max-width: {{ $size.size }}px)" {{ if $.lazy }} class="lazy lazy-hide"
							data-{{ end }}srcset="{{ $noExtension }}.webp" type="image/webp"/>
				{{- end }}
				<!-- Original -->
				<source media="(max-width: {{ $size.size }}px)" {{ if $.lazy }} loading="lazy" {{- end }}
						width="{{ $src.Width }}" height="{{ $src.Height }}"
						srcset="{{ $src.RelPermalink }}"/>
			{{- end }}
		 {{ end }}
	{{- end }}
	<!-- Original - AVIF/WebP -->
	{{ if $showAvifWebp -}}
		{{ $noExtension := strings.TrimSuffix (path.Ext .image.RelPermalink) .image.RelPermalink }}
		<!-- AVIF -->
		<img {{ if .lazy }} loading="lazy" {{- end }}
			src="{{ $noExtension }}.avif"
			alt="{{ with .alt -}} {{ . }} {{- end }}"
			type="image/avif"
			width="{{ .image.Width }}" height="{{ .image.Height }}"/>
		<!-- WebP -->
		<img {{ if .lazy }} loading="lazy" {{- end }}
			src="{{ $noExtension }}.webp"
			alt="{{ with .alt -}} {{ . }} {{- end }}"
			type="image/webp"
			width="{{ .image.Width }}" height="{{ .image.Height }}"/>
	{{- end }}
	<!-- Original - Image -->
	<img {{ if .lazy }} loading="lazy" {{- end }}
		src="{{ .image.RelPermalink }}"
		alt="{{ with .alt -}} {{ . }} {{- end }}"
		width="{{ .image.Width}}" height="{{ .image.Height }}"/>
	<!-- NoScript -->
	{{ if .lazy -}}
		<noscript>
			<img src="{{ .image.RelPermalink }}" alt="{{ with .alt -}} {{ . }} {{- end }}"
				 width="{{ .image.Width}}" height="{{ .image.Height }}"/>
		</noscript>
	{{- end }}
{{- else -}}
	{{ warnf "Image not found with url: %s" .url }}
{{- end }}
